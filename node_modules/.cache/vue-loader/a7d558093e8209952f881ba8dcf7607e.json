{"remainingRequest":"/Users/gujiahao/Documents/work/github/artweb/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gujiahao/Documents/work/github/artweb/src/components/amap.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/gujiahao/Documents/work/github/artweb/src/components/amap.vue","mtime":1588230106466},{"path":"/Users/gujiahao/Documents/work/github/artweb/node_modules/cache-loader/dist/cjs.js","mtime":1579587180818},{"path":"/Users/gujiahao/Documents/work/github/artweb/node_modules/babel-loader/lib/index.js","mtime":1585810045725},{"path":"/Users/gujiahao/Documents/work/github/artweb/node_modules/cache-loader/dist/cjs.js","mtime":1579587180818},{"path":"/Users/gujiahao/Documents/work/github/artweb/node_modules/vue-loader/lib/index.js","mtime":1585810053320}],"contextDependencies":[],"result":["//\n//\n//\n//\n\nimport Util from '@utils';\n\nexport default {\n  name: 'AMap',\n  props: {\n    width: {\n      type: [Number, String],\n      default: '100%'\n    },\n    height: {\n      type: [Number, String],\n      default: '270px'\n    },\n    options: {\n      type: Object,\n      default () {\n        return {};\n      }\n    },\n    complete: Function,\n    error: Function,\n    poicallback: Function\n  },\n  data () {\n    return {\n      setting: {\n        map: {\n          resizeEnable: true\n        },\n        geolocation: {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          buttonOffset: 0,\n          zoomToAccuracy: true,\n          buttonPosition: 'RB'\n        },\n        radius: 1000\n      },\n      position: null\n    };\n  },\n  methods: {\n    /**\n     * 初始化定位\n     * @private\n     */\n    _initializationGeo () {\n      let geolocation;\n      const { AMap } = window;\n      const { setting } = this;\n\n      // 加载地图，调用浏览器定位服务\n      const map = new AMap.Map(document.getElementById('amap'), setting.map);\n\n      map.plugin('AMap.Geolocation', () => {\n        geolocation = new AMap.Geolocation(setting.geolocation);\n\n        map.addControl(geolocation);\n        geolocation.getCurrentPosition();\n        AMap.event.addListener(geolocation, 'complete', this._onComplete);\n        AMap.event.addListener(geolocation, 'error', this._onError);\n      });\n    },\n\n    /**\n     * 定位成功后触发\n     * @param {Object} data 高德地图返回的坐标内容\n     * @private\n     */\n    _onComplete (data) {\n      this.position = data.position;\n      this._coordConvert(this.position);\n      data.position = this.position;\n      if (this.complete && typeof this.complete === 'function') {\n        this.complete(data);\n      }\n    },\n\n    /**\n     * 定位失败后触发\n     * @param {Object} err 报错信息\n     */\n    _onError (err) {\n      if (this.error && typeof this.error === 'function') {\n        this.error(err);\n      }\n    },\n\n    /**\n     * 高德坐标转换成百度坐标\n     * @param {Object} position 坐标位置\n     */\n    _coordConvert (position) {\n      const x = position.lng;\n      const y = position.lat;\n      const { BMap } = window;\n      const ggPoint = new BMap.Point(x, y);\n      const convertor = new BMap.Convertor();\n      const pointArr = [];\n\n      pointArr.push(ggPoint);\n      convertor.translate(pointArr, 3, 5, (data) => {\n        const points = data.points[0];\n\n        position.lng = points.lng;\n        position.lat = points.lat;\n        // 周边检索\n        this.searchQuery(position.lng, position.lat);\n      });\n    },\n\n    /**\n     * 周边检索\n     * @param {Object} lng 百度地图的纬度\n     * @param {Object} lat 百度地图的精度\n     */\n    searchQuery (lng, lat) {\n      Util.loaderLibrary({\n        src: `//api.map.baidu.com/geocoder/v2/?callback=_addrFrameCallback&location=${lat},${lng}&output=json&pois=1&ak=K5LXDCfHLnGvLDQsZx0AKyXNV5kLObYF&radius=${this.setting.radius}`,\n        type: 'js',\n        inject: 'body'\n      });\n    }\n  },\n  created () {\n    this.setting = Object.assign(this.setting, this.options);\n\n    Util.loaderLibrary({\n      src: '//webapi.amap.com/maps?v=1.4.6&key=f2cb2852df505ce99f414bff0b93915b',\n      type: 'js',\n      inject: 'head'\n    }, {\n      src: '//api.map.baidu.com/getscript?v=2.0&ak=K5LXDCfHLnGvLDQsZx0AKyXNV5kLObYF&services=&t=20190123111209',\n      type: 'js',\n      inject: 'head'\n    }).then(() => {\n      this.setting.geolocation.buttonOffset = new window.AMap.Pixel(10, 20);\n      this._initializationGeo();\n    });\n\n    window._addrFrameCallback = (data) => {\n      if (this.poicallback && typeof this.poicallback === 'function') {\n        this.poicallback(data);\n      }\n    };\n  }\n};\n",{"version":3,"sources":["amap.vue"],"names":[],"mappings":";;;;;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"amap.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"amap\" id=\"amap\" ref=\"map\" :style=\"{width: width, height: `${parseInt(height)}px`}\"></div>\n</template>\n\n<script>\nimport Util from '@utils';\n\nexport default {\n  name: 'AMap',\n  props: {\n    width: {\n      type: [Number, String],\n      default: '100%'\n    },\n    height: {\n      type: [Number, String],\n      default: '270px'\n    },\n    options: {\n      type: Object,\n      default () {\n        return {};\n      }\n    },\n    complete: Function,\n    error: Function,\n    poicallback: Function\n  },\n  data () {\n    return {\n      setting: {\n        map: {\n          resizeEnable: true\n        },\n        geolocation: {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          buttonOffset: 0,\n          zoomToAccuracy: true,\n          buttonPosition: 'RB'\n        },\n        radius: 1000\n      },\n      position: null\n    };\n  },\n  methods: {\n    /**\n     * 初始化定位\n     * @private\n     */\n    _initializationGeo () {\n      let geolocation;\n      const { AMap } = window;\n      const { setting } = this;\n\n      // 加载地图，调用浏览器定位服务\n      const map = new AMap.Map(document.getElementById('amap'), setting.map);\n\n      map.plugin('AMap.Geolocation', () => {\n        geolocation = new AMap.Geolocation(setting.geolocation);\n\n        map.addControl(geolocation);\n        geolocation.getCurrentPosition();\n        AMap.event.addListener(geolocation, 'complete', this._onComplete);\n        AMap.event.addListener(geolocation, 'error', this._onError);\n      });\n    },\n\n    /**\n     * 定位成功后触发\n     * @param {Object} data 高德地图返回的坐标内容\n     * @private\n     */\n    _onComplete (data) {\n      this.position = data.position;\n      this._coordConvert(this.position);\n      data.position = this.position;\n      if (this.complete && typeof this.complete === 'function') {\n        this.complete(data);\n      }\n    },\n\n    /**\n     * 定位失败后触发\n     * @param {Object} err 报错信息\n     */\n    _onError (err) {\n      if (this.error && typeof this.error === 'function') {\n        this.error(err);\n      }\n    },\n\n    /**\n     * 高德坐标转换成百度坐标\n     * @param {Object} position 坐标位置\n     */\n    _coordConvert (position) {\n      const x = position.lng;\n      const y = position.lat;\n      const { BMap } = window;\n      const ggPoint = new BMap.Point(x, y);\n      const convertor = new BMap.Convertor();\n      const pointArr = [];\n\n      pointArr.push(ggPoint);\n      convertor.translate(pointArr, 3, 5, (data) => {\n        const points = data.points[0];\n\n        position.lng = points.lng;\n        position.lat = points.lat;\n        // 周边检索\n        this.searchQuery(position.lng, position.lat);\n      });\n    },\n\n    /**\n     * 周边检索\n     * @param {Object} lng 百度地图的纬度\n     * @param {Object} lat 百度地图的精度\n     */\n    searchQuery (lng, lat) {\n      Util.loaderLibrary({\n        src: `//api.map.baidu.com/geocoder/v2/?callback=_addrFrameCallback&location=${lat},${lng}&output=json&pois=1&ak=K5LXDCfHLnGvLDQsZx0AKyXNV5kLObYF&radius=${this.setting.radius}`,\n        type: 'js',\n        inject: 'body'\n      });\n    }\n  },\n  created () {\n    this.setting = Object.assign(this.setting, this.options);\n\n    Util.loaderLibrary({\n      src: '//webapi.amap.com/maps?v=1.4.6&key=f2cb2852df505ce99f414bff0b93915b',\n      type: 'js',\n      inject: 'head'\n    }, {\n      src: '//api.map.baidu.com/getscript?v=2.0&ak=K5LXDCfHLnGvLDQsZx0AKyXNV5kLObYF&services=&t=20190123111209',\n      type: 'js',\n      inject: 'head'\n    }).then(() => {\n      this.setting.geolocation.buttonOffset = new window.AMap.Pixel(10, 20);\n      this._initializationGeo();\n    });\n\n    window._addrFrameCallback = (data) => {\n      if (this.poicallback && typeof this.poicallback === 'function') {\n        this.poicallback(data);\n      }\n    };\n  }\n};\n</script>\n\n<style scoped>\n\n</style>\n"]}]}